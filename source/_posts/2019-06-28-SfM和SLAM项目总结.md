---
title: SfM和SLAM项目总结
date: 2019-06-28 18:19:51
categories: SLAM
tags: [SfM,SLAM,机器视觉,单目]
description: 2018.5至2019.5大学生创新创业训练项目经验总结。
mathjax: true
---

> 前言：2019年6月27日，我进行了网易伏羲实验室虚拟人方向的电话面试。在电话中，我支支吾吾连自己的项目都讲不清楚。不管最后面试结果如何，自己做过的东西起码自己要懂。

# 基础知识

## 内积

$$
\bf{a} \cdot \bf{b}=\bf{a}^T\bf{b}=\sum_{i=1}^3a_ib_i=|\bf{a}||\bf{b}|cos<\bf{a,b}>
$$

## 外积

$$
\bf{a} \times \bf{b} = 
\left[ 
\begin{array}{ccc}
{\bf{i}} & {\bf{j}} & {\bf{k}}\\
{a_1} & {a_2} & {a_3}\\{b_1} & {b_2} & {b_3}
\end{array}
\right]
= \left[
\begin{array}{c}
{a_2b_3-a_3b_2}\\
{a_3b_1-a_1b_3}\\
{a_1b_2-a_2b_1}
\end{array}
\right]
=\left[
\begin{array}{ccc}
{0} & {-a_3} & {a_2}\\
{a_3} & {0} & {-a_1}\\
{-a_2} & {a_1} & {0}
\end{array}
\right]
\bf{b}
\triangleq \bf{a} ^\wedge \bf{b}
$$

相应的，有
$$
\boldsymbol{a}=[a_1\boldsymbol{i},a_2\boldsymbol{j},a_3\boldsymbol{k}],\\\boldsymbol{a}^{\wedge}=\boldsymbol{A}=\left[\begin{matrix}0&-a_3&a_2\\a_3&0&-a_1\\-a_2&a_1&0\\\end{matrix}\right],\\\boldsymbol{A}^{\vee}=\boldsymbol{a}
$$

### 特殊正交群 $SO(3)$

$$
SO(3)=\{R\in\mathbb{R}^{3\times3}|RR^T=I,\det(R)=1\}
$$

### 特殊欧式群$SE(3)$

$$
SE(3)=\{T=\left[
\begin{matrix}
R&t\\
0^T&1\\
\end{matrix}
\right]\in\mathbb{R}^{4\times4}|R\in SO(3),t\in \mathbb{R}^3\}李代数$\mathfrak{so}(3)$
$$

### 李代数$\mathfrak{so}(3)$

在对$RR^T=I$进行求导及整理之后，可以得到$R(t)^{'}R(t)^T$是一个反对称矩阵，那么就用一个$\phi(t)\in\mathbb{R}^3$与之对应。有：
$$
R(t)^{'}R(t)^T=\phi(t)^{\wedge}
$$
之后求解微分方程，可以得到：
$$
R(t)=exp(\phi^{\wedge}t)
$$
实际求解时利用到指数映射和对数映射。



## 双目系统

![01](01.jpg)

![02](02.jpg)



## 单应矩阵



## 本质矩阵

## 基本矩阵

# 张正友标定法

[A Flexible New Technique for Camera Calibration](https://www.researchgate.net/publication/3193178_A_Flexible_New_Technique_for_Camera_Calibration)

摘要：张正友标定法只需要相机观察几个（至少两个）不同方向上显示的平面图案。相机或平面图案都可以自由移动。且相机或标定板的运动不需要知道。张正友标定法对径向透镜畸变进行了建模。该方法由一个封闭形式的解组成，然后根据最大似然准则进行非线性改进。

## 数学推导

### 针孔相机模型三维点到二维点投影矩阵

| 符号                        | 含义           |
| --------------------------- | -------------- |
| $m=[u,v]^T$                 | 二维点         |
| $M=[X,Y,Z]^T$               | 三维点         |
| $\widetilde{m}=[u,v,1]^T$   | 二维点齐次坐标 |
| $\widetilde{M}=[X,Y,Z,1]^T$ | 三维点齐次坐标 |
| s            | 随机尺度因子                                                 |
| $\bf{(R,t)}$ | 外参，即将世界坐标系和相机坐标系联系起来的旋转矩阵和位移向量 |
| $\bf{A}$ | 相机内参矩阵 |
| $\alpha,\beta$ | 分别为图像u轴和v轴的尺度因子 |
| $u_0,v_0$ | 光心的图像坐标系坐标 |
| $\gamma$ | 描述图像轴u,v之间的倾斜 |

$$
s \widetilde{\bf{m}} = \bf{A[R\quad t]\widetilde{M}}
$$

其中，
$$
A = \left[ \begin{array}{ccc} {\alpha} & {\gamma} & {u_0}\\ {0} & {\beta} & {v_0}\\ {0} & {0} & {1}\end{array}\right]
$$





### 标定板平面与图像之间的单应性矩阵

这里假设标定板所在的平面为空间坐标系下的$Z=0$。

| 符号       | 含义                    |
| ---------- | ----------------------- |
| $\bf{r_i}$ | 旋转矩阵$\bf{R}$的第i列 |

$$
s\left[\begin{array}{c}{u}\\{v}\\{1}\end{array}\right]=\bf{A}[\begin{array}{cccc}{\bf{r_1}}&{\bf{r_2}}&{\bf{r_3}}&{\bf{t}}\end{array}]\left[\begin{array}{c}{X}\\{Y}\\{0}\\{1}\end{array}\right]=A[\begin{array}{ccc}{\bf{r_1}}&{\bf{r_2}}&{\bf{t}}\end{array}]\left[\begin{array}{c}{X}\\{Y}\\{1}\end{array}\right]
$$

即：
$$
s\widetilde{\bf{m}}=\bf{H\widetilde{M}}
$$
其中，$\bf{H}$为单应矩阵，$\bf{H=A[\begin{array}{ccc}{\bf{r_1}}&{\bf{r_2}}&{\bf{t}}\end{array}]}$。

### 内参约束

假设$\bf{H}=\left[\begin{array}{ccc}{\bf{h_1}}&{\bf{h_2}}&{\bf{h_3}}\end{array}\right]$，根据单应关系有：
$$
\left[\begin{array}{ccc}{\bf{h_1}}&{\bf{h_2}}&{\bf{h_3}}\end{array}\right]=\lambda \bf{A}[\begin{array}{ccc}{\bf{r_1}}&{\bf{r_2}}&{\bf{t}}\end{array}]
$$
根据$\bf{r_1}$和$\bf{r_2}$正交，有：
$$
\begin{split}
h_1^TA^{-T}A^{-1}h_2=0 \\ 
h_1^TA^{-T}A^{-1}h_1= h_2^TA^{-T}A^{-1}h_2
\end{split}
$$

### 几何解释



# SfM

## 三角化

## PnP

# SLAM

## ORB_SLAM流程

## g2o图优化

## 数据可视化VTK、Pangolin

# Tower



